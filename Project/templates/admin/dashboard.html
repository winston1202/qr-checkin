{% extends "admin/base_layout.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Currently Clocked In -->
    <div class="lg:col-span-2">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Currently Clocked In</h2>
            <div id="currently-in-container">
                {% if currently_in %}
                    <div class="overflow-x-auto">
                        <table class="w-full text-left min-w-[500px]">
                            <thead>
                                <tr>
                                    <th class="py-2">Name</th>
                                    <th class="py-2">Clock In Time</th>
                                    <th class="py-2">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for person in currently_in %}
                                <tr class="border-t">
                                    <td class="py-3 font-semibold">{{ person.user.name }}</td>
                                    <td class="py-3 text-gray-600">{{ person.clock_in }}</td>
                                    <td class="py-3">
                                        <form action="{{ url_for('admin.fix_clock_out', log_id=person.id) }}" method="POST">
                                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold py-2 px-3 rounded">
                                                Clock Out Now
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-gray-600">No one is currently clocked in.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div class="lg:col-span-1 space-y-8">
        <!-- Share / Invite Card -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Invite Your Team</h2>
            <p class="text-gray-600 mb-4">Click below to copy your team's invitation link or print the QR code.</p>
            <input type="hidden" id="joinLinkInput" value="{{ join_link }}">
            <button id="shareBtn" class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">
                Share Invitation
            </button>
        </div>

        <!-- Team Stats -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Team Stats</h2>
            <p class="text-gray-600">Total Users on Team: <strong class="text-xl">{{ user_count }}</strong></p>
        </div>
    </div>
</div>

<!-- === SHARE MODAL === -->
<div id="shareModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full flex items-center justify-center hidden">
    <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
        <h3 class="text-lg text-center font-medium text-gray-900">Invite Your Team</h3>

        <div class="mt-4 px-7 py-3 space-y-3">
            <!-- Copy link -->
            <button id="copyLinkBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                Copy Link
            </button>

            <!-- Print QR -->
            <a href="{{ url_for('admin.print_qr_code') }}" target="_blank"
               class="block w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-center">
                Print QR Code
            </a>
        </div>

        <div class="mt-4 px-4 py-3 border-t">
            <button id="closeModalBtn" class="px-4 py-2 bg-gray-200 rounded-md w-full">Cancel</button>
        </div>
    </div>
</div>

<!-- === INLINE SCRIPT === -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const shareBtn = document.getElementById('shareBtn');
    const shareModal = document.getElementById('shareModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const copyLinkBtn = document.getElementById('copyLinkBtn');

    shareBtn.addEventListener('click', () => shareModal.classList.remove('hidden'));
    closeModalBtn.addEventListener('click', () => shareModal.classList.add('hidden'));
    copyLinkBtn.addEventListener('click', () => {
        const input = document.getElementById('joinLinkInput');
        navigator.clipboard.writeText(input.value).then(() => {
            alert('Invitation link copied!');
            shareModal.classList.add('hidden');
        });
    });
});
</script>
{% endblock %}
