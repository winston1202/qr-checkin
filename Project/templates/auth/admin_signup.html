<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Create Your Team - QrCheckin</title>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-enter { animation: bounceIn 0.8s ease-out; }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3); } 50% { opacity: 1; transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="bg-white/90 backdrop-blur-sm p-8 rounded-2xl shadow-2xl w-full max-w-md card-enter">
        <div class="text-center mb-6">
            <h1 id="signup-heading" class="text-3xl font-bold text-gray-800 mb-2">Create Your Team</h1>
            <p id="signup-sub" class="text-gray-600">Start tracking time in less than a minute.</p>
        </div>

        <form action="{{ url_for('auth.admin_signup') }}" method="POST" class="space-y-4">
            <div id="team-name-row">
                <label for="team_name" class="block text-sm text-left font-medium text-gray-700">Team Name</label>
                <input id="team_name" name="team_name" placeholder="e.g., Main Office Staff" required class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label for="name" class="block text-sm text-left font-medium text-gray-700">Your Full Name</label>
                <input id="name" name="name" placeholder="e.g., Jane Doe" required class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label for="email" class="block text-sm text-left font-medium text-gray-700">Your Email (for login)</label>
                <input id="email" name="email" type="email" placeholder="you@company.com" required class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label for="password" class="block text-sm text-left font-medium text-gray-700">Password</label>
                <input id="password" name="password" type="password" required class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <!-- Role selection -->
            <div>
                <label class="block text-sm text-left font-medium text-gray-700">Account Type</label>
                <div class="mt-2 flex gap-4">
                    <label class="inline-flex items-center">
                        <input type="radio" name="role" value="Admin" checked class="form-radio">
                        <span class="ml-2 text-sm">Admin (create a new team)</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="role" value="User" class="form-radio">
                        <span class="ml-2 text-sm">Employee (join existing team)</span>
                    </label>
                </div>
            </div>

            <!-- Join token (only for Employee signups) -->
            <div id="join-token-row" style="display:none;">
                <label for="join_token" class="block text-sm text-left font-medium text-gray-700">Team Invitation Token</label>
                <input id="join_token" name="join_token" placeholder="Paste invitation token here" class="mt-1 w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="text-xs text-gray-500 mt-1">Ask your admin for the team invitation token (join link).</p>
            </div>
            
            <!-- === THIS IS THE NEWLY ADDED SECTION === -->
            <div class="flex items-start pt-2">
                <div class="flex items-center h-5">
                    <input id="terms" name="terms" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                </div>
                <div class="ml-3 text-sm text-left">
                    <label for="terms" class="text-gray-700">
                        I agree to the 
                        <a href="{{ url_for('auth.terms_of_service') }}" target="_blank" class="font-medium text-blue-600 hover:underline">Terms of Service</a> 
                        and 
                        <a href="{{ url_for('auth.privacy_policy') }}" target="_blank" class="font-medium text-blue-600 hover:underline">Privacy Policy</a>.
                    </label>
                </div>
            </div>
            <!-- === END OF NEW SECTION === -->

            <button id="signup-button" type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl !mt-6 transition">
                Create Account & Team
            </button>
        </form>
        
        <p class="text-center text-gray-600 mt-6">
            Already have an account? 
            <a href="{{ url_for('auth.login') }}" class="font-medium text-blue-600 hover:text-blue-500">Log In</a>
        </p>
    </div>
    <script>
        // Toggle join token input when role changes and validate on submit
        const roleRadios = document.querySelectorAll('input[name="role"]');
        const joinRow = document.getElementById('join-token-row');
        const joinInput = document.getElementById('join_token');
        const form = document.querySelector('form');
        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    const teamNameRow = document.getElementById('team-name-row');
    const signupHeading = document.getElementById('signup-heading');
    const signupButton = document.getElementById('signup-button');

        function updateJoinVisibility() {
            const val = document.querySelector('input[name="role"]:checked').value;
            if (val === 'User') {
                joinRow.style.display = 'block';
                teamNameRow.style.display = 'none';
                signupHeading.textContent = 'Create Employee Account';
                signupButton.textContent = 'Create Account & Join Team';
            } else {
                joinRow.style.display = 'none';
                teamNameRow.style.display = 'block';
                signupHeading.textContent = 'Create Your Team';
                signupButton.textContent = 'Create Account & Team';
            }
        }

        roleRadios.forEach(r => r.addEventListener('change', updateJoinVisibility));

        // Auto-fill join token from URL parameter if present and select Employee
        (function autoFillFromUrl() {
            try {
                const params = new URLSearchParams(window.location.search);
                const token = params.get('join_token') || params.get('token');
                if (token) {
                    // select employee role
                    const userRadio = document.querySelector('input[name="role"][value="User"]');
                    if (userRadio) userRadio.checked = true;
                    joinInput.value = token;
                    updateJoinVisibility();
                }
            } catch (e) {
                // ignore URL parsing errors
            }
        })();

        // Simple client-side validation: require join token when role=User and check UUID-ish format
        form.addEventListener('submit', function (ev) {
            const role = document.querySelector('input[name="role"]:checked').value;
            if (role === 'User') {
                const token = joinInput.value.trim();
                if (!token) {
                    ev.preventDefault();
                    alert('Please provide the team invitation token to join as an Employee.');
                    return false;
                }
                if (!uuidRegex.test(token)) {
                    // not strictly required to be a UUID, but warn if format looks wrong
                    const ok = confirm('The token you entered does not look like a typical invitation token. Continue anyway?');
                    if (!ok) {
                        ev.preventDefault();
                        return false;
                    }
                }
            }
        });
    </script>
</body>
</html>